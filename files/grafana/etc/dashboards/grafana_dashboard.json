{
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": {
            "type": "grafana",
            "uid": "-- Grafana --"
          },
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "type": "dashboard"
        }
      ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "id": 1,
    "links": [],
    "panels": [
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 0
        },
        "id": 46,
        "panels": [],
        "title": "Linky $last_update ($last_temperature°C)",
        "type": "row"
      },
      {
        "datasource": {
          "type": "datasource",
          "uid": "-- Dashboard --"
        },
        "fieldConfig": {
          "defaults": {
            "decimals": 0,
            "fieldMinMax": false,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "dark-green",
                  "value": null
                },
                {
                  "color": "#EAB839",
                  "value": 0
                }
              ]
            },
            "unit": "W"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 9,
          "w": 6,
          "x": 0,
          "y": 1
        },
        "id": 39,
        "options": {
          "allowNeedleCrossLimits": false,
          "animateNeedleValueTransition": true,
          "animateNeedleValueTransitionSpeed": 500,
          "edgeWidth": 0.01,
          "gaugeRadius": 0,
          "innerColor": "#181b1f",
          "markerEndEnabled": false,
          "markerEndShape": "stub",
          "markerStartEnabled": false,
          "markerStartShape": "circle",
          "maxNeedleAngle": 320,
          "maxTickAngle": 300,
          "maxValue": 500,
          "minValue": 0,
          "needleColor": "dark-red",
          "needleCrossLimitDegrees": 10,
          "needleLengthNeg": 0,
          "needleTickGap": 0.05,
          "needleWidth": 10,
          "operatorName": "last",
          "outerEdgeColor": "#7c7c87",
          "padding": 0.05,
          "pivotColor": "text",
          "pivotRadius": 0.1,
          "showThresholdBandLowerRange": true,
          "showThresholdBandMiddleRange": false,
          "showThresholdBandOnGauge": true,
          "showThresholdBandUpperRange": false,
          "showThresholdStateOnBackground": false,
          "showThresholdStateOnValue": false,
          "tickEdgeGap": 0.05,
          "tickFont": "Inter",
          "tickLabelColor": "text",
          "tickLabelFontSize": 28,
          "tickLengthMaj": 0.15,
          "tickLengthMin": 0.05,
          "tickMajorColor": "text",
          "tickMapConfig": {
            "tickMaps": []
          },
          "tickMinorColor": "text",
          "tickSpacingMajor": 100,
          "tickSpacingMinor": 25,
          "tickWidthMajor": 3,
          "tickWidthMinor": 1,
          "ticknessGaugeBasis": 200,
          "unitsLabelColor": "text",
          "valueFont": "Inter",
          "valueFontSize": 54,
          "valueYOffset": 0,
          "zeroNeedleAngle": 40,
          "zeroTickAngle": 60
        },
        "pluginVersion": "2.0.1",
        "targets": [
          {
            "datasource": {
              "type": "datasource",
              "uid": "-- Dashboard --"
            },
            "panelId": 1,
            "refId": "A"
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "filterByRefId",
            "options": {
              "include": "A"
            }
          },
          {
            "id": "sortBy",
            "options": {
              "fields": {},
              "sort": [
                {
                  "desc": true,
                  "field": "time"
                }
              ]
            }
          },
          {
            "id": "limit",
            "options": {
              "limitField": "1"
            }
          }
        ],
        "transparent": true,
        "type": "briangann-gauge-panel"
      },
      {
        "description": "",
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 1,
          "w": 6,
          "x": 6,
          "y": 1
        },
        "id": 11,
        "options": {
          "activeTheme": "Linkystat",
          "disableThemePicker": true,
          "themes": [
            {
              "name": "Linkystat",
              "styles": [
                {
                  "props": {
                    "theme": "dark"
                  },
                  "type": "basetheme"
                },
                {
                  "props": {
                    "url": ""
                  },
                  "type": "bgimage"
                },
                {
                  "props": {
                    "url": ""
                  },
                  "type": "url"
                },
                {
                  "props": {
                    "text": "body {\n    background-color: rgb(24, 27, 31);\n}\n\nh6[title=\"Linky\"] {\n    font-size: 1.5em;\n}\n\ndiv[data-testid='Panel'] span {\n    font-family: monospace;\n}\n\n.css-ghhp3m {\n    left: 0%;\n    transform: initial;\n    padding: 0px;\n    position: inherit;\n    top: 0%;\n}\n\ndiv:has(> div[data-testid='data-testid dashboard controls']) {\n    background-color: rgb(24, 27, 31);\n}"
                  },
                  "type": "style"
                },
                {
                  "props": {
                    "color": ""
                  },
                  "type": "panel-container-bg-color"
                }
              ]
            }
          ]
        },
        "pluginVersion": "0.2.1",
        "title": "",
        "transparent": true,
        "type": "yesoreyeram-boomtheme-panel"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "fixedColor": "semi-dark-green",
              "mode": "continuous-GrYlRd",
              "seriesBy": "last"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisGridShow": false,
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "barWidthFactor": 0.7,
              "drawStyle": "line",
              "fillOpacity": 100,
              "gradientMode": "scheme",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "stepBefore",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 0,
              "pointSize": 1,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "fieldMinMax": true,
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "W"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "time"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "dateTimeAsLocalNoDateIfToday"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Consommation veille"
              },
              "properties": [
                {
                  "id": "custom.axisPlacement",
                  "value": "auto"
                },
                {
                  "id": "custom.transform",
                  "value": "constant"
                },
                {
                  "id": "custom.drawStyle",
                  "value": "line"
                },
                {
                  "id": "custom.lineWidth",
                  "value": 2
                },
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#08028b",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.fillOpacity",
                  "value": 0
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "dash": [
                      10,
                      10
                    ],
                    "fill": "dash"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 1
        },
        "id": 1,
        "interval": "2s",
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": false
          },
          "timezone": [
            "browser"
          ],
          "tooltip": {
            "hideZeros": false,
            "maxHeight": 600,
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "11.4.0",
        "targets": [
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT \r\n  $__timeGroupAlias(time, $__interval), \r\n  ROUND(PAPP * $cosphi / 5) * 5 AS \"Puissance apparente\" \r\nFROM linky.linky_realtime \r\nWHERE $__timeFilter(time) \r\n",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "name": "AVG",
                  "parameters": [
                    {
                      "name": "PAPP",
                      "type": "functionParameter"
                    }
                  ],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "name": "time",
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            },
            "table": "linky_realtime"
          },
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "hide": false,
            "rawQuery": true,
            "rawSql": "SELECT\r\n  MAX(time),\r\n  ${consommation_veille:raw} AS \"Consommation veille\"\r\nFROM\r\n  linky.linky_realtime;",
            "refId": "B",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transparent": true,
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 2,
          "w": 6,
          "x": 6,
          "y": 2
        },
        "id": 30,
        "options": {
          "baseValueField": "base",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 0,
          "percentageValueDecimals": 0,
          "percentageValueField": "current",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé aux 24h précédentes",
          "referenceTextFontSize": "10px",
          "unit": "W sur 24h"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "\r\n(SELECT\r\n \"current\",\r\n (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / 24 as total_kwh\r\nFROM linky_realtime\r\nWHERE time >= NOW() - INTERVAL 1 DAY)\r\nUNION\r\n(SELECT \r\n \"base\",\r\n (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / 24 as total_kwh\r\nFROM linky_realtime\r\nWHERE time BETWEEN NOW() - INTERVAL 2 DAY AND NOW() - INTERVAL 1 DAY)",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "provider_time",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "total_kwh",
                  "handlerKey": "field.value"
                },
                {
                  "fieldName": "current",
                  "handlerKey": "field.name"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "datasource": {
          "default": true,
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 2,
          "w": 6,
          "x": 6,
          "y": 4
        },
        "id": 28,
        "options": {
          "baseValueField": "base",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 0,
          "percentageValueField": "current",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé à la moyenne du mois",
          "referenceTextFontSize": "10px",
          "unit": "€/j"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "\r\n(SELECT\r\n \"current\",\r\n    (((MAX(HCHP) - MIN(HCHP)) * $prix_hp + (MAX(HCHC) - MIN(HCHC)) * $prix_hc)  / 1000) + ($abonnement / $nb_days_period) as total_kwh\r\nFROM linky_realtime\r\nWHERE time > NOW() - INTERVAL 1 DAY)\r\nUNION\r\n(SELECT \r\n\t\"base\",\r\n    (((MAX(HCHP) - MIN(HCHP)) * $prix_hp + (MAX(HCHC) - MIN(HCHC)) * $prix_hc) / 1000 / $nb_days_period) + ($abonnement / $nb_days_period)  as total_kwh\r\nFROM linky_history\r\nWHERE time BETWEEN NOW() - INTERVAL $nb_days_period DAY AND NOW())",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "provider_time",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "total_kwh",
                  "handlerKey": "field.value"
                },
                {
                  "fieldName": "current",
                  "handlerKey": "field.name"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 2,
          "w": 6,
          "x": 6,
          "y": 6
        },
        "id": 42,
        "options": {
          "baseValueField": "base",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 0,
          "percentageValueDecimals": 1,
          "percentageValueField": "current",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé à la moyenne du mois",
          "referenceTextFontSize": "10px",
          "unit": "kWh/j"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "\r\n(SELECT\r\n \"current\",\r\n (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / 1000 as total_kwh\r\nFROM linky_realtime\r\nWHERE time >= NOW() - INTERVAL 1 DAY)\r\nUNION\r\n(SELECT \r\n \"base\",\r\n (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / $nb_days_period / 1000 as total_kwh\r\nFROM linky_history\r\nWHERE time >= NOW() - INTERVAL $nb_days_period DAY)",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "provider_time",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "total_kwh",
                  "handlerKey": "field.value"
                },
                {
                  "fieldName": "current",
                  "handlerKey": "field.name"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 2,
          "w": 6,
          "x": 6,
          "y": 8
        },
        "id": 63,
        "options": {
          "baseValueField": "",
          "baseValueFontSize": "0",
          "interpretAsTrend": true,
          "percentageNrDecimals": 2,
          "percentageValueField": "Consommation veille",
          "percentageValueFontSize": "80%",
          "positiveIsGood": true,
          "referenceText": "Consommation en veille",
          "referenceTextFontSize": "12px",
          "unit": "W"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT $consommation_veille as \"Consommation veille\"",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 10
        },
        "id": 54,
        "panels": [],
        "title": "Historique du mois",
        "type": "row"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "continuous-GrYlRd"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisGridShow": false,
              "axisLabel": "",
              "axisPlacement": "auto",
              "fillOpacity": 100,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "lineWidth": 0,
              "scaleDistribution": {
                "type": "linear"
              },
              "thresholdsStyle": {
                "mode": "dashed"
              }
            },
            "decimals": 1,
            "displayName": "Consommation",
            "fieldMinMax": true,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "super-light-green",
                  "value": null
                }
              ]
            },
            "unit": "kwatth"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "timestamp"
              },
              "properties": [
                {
                  "id": "unit"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 11
        },
        "id": 57,
        "options": {
          "barRadius": 0.5,
          "barWidth": 0.8,
          "colorByField": "total_kwh",
          "fullHighlight": false,
          "groupWidth": 0.75,
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": false
          },
          "orientation": "vertical",
          "showValue": "never",
          "stacking": "none",
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          },
          "xField": "timestamp",
          "xTickLabelRotation": 0,
          "xTickLabelSpacing": -100
        },
        "pluginVersion": "11.4.0",
        "targets": [
          {
            "dataset": "linky",
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "(\r\n  SELECT\r\n    DATE(DATE_FORMAT(MAX(time), '%Y-%m-%d 00:00:00')) as \"timestamp\",\r\n    (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / 1000 as \"total_kwh\"\r\n  FROM\r\n    linky_realtime\r\n  WHERE\r\n    time >= NOW() - INTERVAL 1 DAY\r\n)\r\nUNION\r\nALL (\r\n  SELECT\r\n    time as \"timestamp\",\r\n    IFNULL(\r\n      LEAD(counter) OVER (\r\n        ORDER BY\r\n          time\r\n      ) - counter,\r\n      0\r\n    ) AS \"total_kwh\"\r\n  FROM\r\n    (\r\n      SELECT\r\n        time,\r\n        (HCHP + HCHC) / 1000 as counter\r\n      FROM\r\n        linky_history\r\n      WHERE\r\n        DATE(time) >= NOW() - INTERVAL 1 MONTH\r\n        AND HOUR(time) = 0\r\n        AND MINUTE(time) = 0\r\n        AND DATE(time) <> DATE(time + INTERVAL 1 DAY)\r\n    ) B\r\n)\r\nORDER BY\r\n  timestamp",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          },
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "hide": false,
            "rawQuery": true,
            "rawSql": "SELECT \r\n (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / $nb_days_period / 1000 as \"Moyenne mois\"\r\nFROM linky_history\r\nWHERE time >= NOW() - INTERVAL $nb_days_period DAY",
            "refId": "B",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "filterByValue",
            "options": {
              "filters": [
                {
                  "config": {
                    "id": "equal",
                    "options": {
                      "value": ""
                    }
                  },
                  "fieldName": "total_kwh"
                }
              ],
              "match": "any",
              "type": "exclude"
            }
          },
          {
            "id": "formatTime",
            "options": {
              "outputFormat": "DD.MM",
              "timeField": "timestamp",
              "timezone": "browser",
              "useTimezone": true
            }
          },
          {
            "id": "configFromData",
            "options": {
              "applyTo": {
                "id": "byFrameRefID",
                "options": "A"
              },
              "configRefId": "B",
              "mappings": [
                {
                  "fieldName": "Moyenne mois",
                  "handlerArguments": {
                    "threshold": {
                      "color": "blue"
                    }
                  },
                  "handlerKey": "threshold1"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "barchart"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "fixed"
            },
            "custom": {
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              }
            },
            "decimals": 0,
            "fieldMinMax": false,
            "mappings": [],
            "unit": "percent"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Heures pleines"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "semi-dark-red",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Heures creuses"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "semi-dark-blue",
                    "mode": "fixed"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 6,
          "x": 12,
          "y": 11
        },
        "id": 56,
        "options": {
          "displayLabels": [
            "name",
            "value"
          ],
          "legend": {
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": false
          },
          "pieType": "donut",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "asc"
          }
        },
        "pluginVersion": "11.4.0",
        "targets": [
          {
            "dataset": "linky",
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT\r\n    ((MAX(HCHP) - MIN(HCHP)) * 100) / (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) AS \"Heures pleines\",\r\n    ((MAX(HCHC) - MIN(HCHC)) * 100) / (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) AS \"Heures creuses\"\r\nFROM linky.linky_history\r\nWHERE\r\n    time >= (NOW() - INTERVAL 1 MONTH)",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transparent": true,
        "type": "piechart"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 18,
          "y": 11
        },
        "id": 40,
        "options": {
          "baseValueField": "base",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 2,
          "percentageValueDecimals": 0,
          "percentageValueField": "current",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé à hier",
          "referenceTextFontSize": "10px",
          "unit": "kWh"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "(SELECT \r\n  \"current\",\r\n  (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / 1000 as t\r\nFROM linky_history\r\nWHERE time BETWEEN NOW() - INTERVAL $nb_days_period DAY - INTERVAL 1 HOUR AND NOW())\r\nUNION\r\n(SELECT \r\n  \"base\",\r\n  (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / 1000 as t\r\nFROM linky_history\r\nWHERE time BETWEEN NOW() - INTERVAL $nb_days_period DAY - INTERVAL 1 DAY - INTERVAL 1 HOUR AND NOW() - INTERVAL 1 DAY)",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Consommation du mois",
        "transformations": [
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "current",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "t",
                  "handlerKey": "field.value"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "datasource": {
          "type": "datasource",
          "uid": "-- Dashboard --"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 18,
          "y": 14
        },
        "id": 36,
        "options": {
          "baseValueField": "0",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 2,
          "percentageValueDecimals": 0,
          "percentageValueField": "1",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé au mois dernier",
          "referenceTextFontSize": "10px",
          "unit": "€"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "datasource": {
              "type": "datasource",
              "uid": "-- Dashboard --"
            },
            "panelId": 58,
            "refId": "A",
            "withTransforms": false
          }
        ],
        "title": "Coût du mois",
        "transformations": [
          {
            "id": "sortBy",
            "options": {
              "fields": {},
              "sort": [
                {
                  "desc": true,
                  "field": "timestamp"
                }
              ]
            }
          },
          {
            "id": "limit",
            "options": {
              "limitField": "2"
            }
          },
          {
            "id": "filterByValue",
            "options": {
              "filters": [
                {
                  "config": {
                    "id": "isNotNull",
                    "options": {}
                  },
                  "fieldName": "total_kwh_HCHP"
                },
                {
                  "config": {
                    "id": "isNotNull",
                    "options": {}
                  },
                  "fieldName": "total_kwh_HCHC"
                }
              ],
              "match": "all",
              "type": "include"
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hp",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHP"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$prix_hp"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              },
              "replaceFields": false
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hc",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHC"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$prix_hc"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hors_abo",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hp"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hc"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hors_abo"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$abonnement"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "mode": "index",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "Row",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "cout_hors_abo + abonnement",
                  "handlerKey": "field.value"
                },
                {
                  "fieldName": "timestamp",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "total_kwh_HCHP",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "total_kwh_HCHC",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "Temperature",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "cout_hp",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "cout_hc",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "cout_hors_abo",
                  "handlerKey": "__ignore"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "datasource": {
          "type": "datasource",
          "uid": "-- Dashboard --"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 18,
          "y": 17
        },
        "id": 33,
        "options": {
          "baseValueField": "1",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 2,
          "percentageValueField": "0",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé au mois dernier",
          "referenceTextFontSize": "10px",
          "unit": "W"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "datasource": {
              "type": "datasource",
              "uid": "-- Dashboard --"
            },
            "panelId": 58,
            "refId": "A",
            "withTransforms": true
          }
        ],
        "title": "Puissance moyenne mois",
        "transformations": [
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "dateFormat": "MM/YYYY",
                  "destinationType": "time",
                  "targetField": "Date"
                }
              ],
              "fields": {}
            }
          },
          {
            "id": "sortBy",
            "options": {
              "fields": {},
              "sort": [
                {
                  "desc": true,
                  "field": "Date"
                }
              ]
            }
          },
          {
            "id": "limit",
            "options": {
              "limitField": "2"
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "Consommation"
                  }
                },
                "operator": "*",
                "right": {
                  "fixed": "1000"
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "Consommation * 1000"
                  }
                },
                "operator": "/",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$nb_days_period"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "Consommation * 1000 / nb_days_period"
                  }
                },
                "operator": "/",
                "right": {
                  "fixed": "24"
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "fixed": ""
                },
                "right": {
                  "fixed": ""
                }
              },
              "mode": "index",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "Consommation",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "Consommation * 1000",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "Date",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "Consommation * 1000 / nb_days_period / 24",
                  "handlerKey": "field.value"
                },
                {
                  "fieldName": "Row",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "Consommation * 1000 / nb_days_period",
                  "handlerKey": "__ignore"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 20
        },
        "id": 45,
        "panels": [],
        "title": "Historique par mois",
        "type": "row"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "continuous-GrYlRd"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisGridShow": false,
              "axisLabel": "",
              "axisPlacement": "auto",
              "fillOpacity": 100,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "lineWidth": 0,
              "scaleDistribution": {
                "type": "linear"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 1,
            "displayName": "Consommation",
            "fieldMinMax": true,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "kwatth"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byFrameRefID",
                "options": "B"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "celsius"
                },
                {
                  "id": "decimals",
                  "value": 1
                },
                {
                  "id": "displayName"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Date"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": ""
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Consommation"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "kWh"
                },
                {
                  "id": "decimals",
                  "value": 0
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 21
        },
        "id": 58,
        "options": {
          "barRadius": 0.5,
          "barWidth": 0.8,
          "colorByField": "total_kwh",
          "fullHighlight": false,
          "groupWidth": 0.7,
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": false
          },
          "orientation": "vertical",
          "showValue": "never",
          "stacking": "none",
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          },
          "xField": "Date",
          "xTickLabelRotation": 0,
          "xTickLabelSpacing": 100
        },
        "pluginVersion": "11.4.0",
        "targets": [
          {
            "dataset": "linky",
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "(\r\nSELECT\r\n    TIMESTAMP(DATE_FORMAT(MAX(time) - INTERVAL $jour_releve_compteur DAY + INTERVAL IF($jour_releve_compteur<15, 0, 1) MONTH + INTERVAL IF($jour_releve_compteur<15, 0, 1) DAY, '%Y-%m-$jour_releve_compteur 00:00:00')) as \"timestamp\",\r\n\t(MAX(HCHP) - MIN(HCHP)) / 1000 AS \"total_kwh_HCHP\",\r\n    (MAX(HCHC) - MIN(HCHC)) / 1000 AS \"total_kwh_HCHC\"\r\nFROM linky_history\r\nWHERE time >= NOW() - INTERVAL $nb_days_period DAY - INTERVAL 1 HOUR\r\n)\r\nUNION\r\n(SELECT\r\n      time as \"timestamp\", \r\n      IFNULL(counter_HCHP - LAG(counter_HCHP) OVER (ORDER BY time), 0) AS \"total_kwh_HCHP\",\r\n      IFNULL(counter_HCHC - LAG(counter_HCHC) OVER (ORDER BY time), 0) AS \"total_kwh_HCHC\"\r\nFROM\r\n    (SELECT time, HCHP / 1000 as counter_HCHP, HCHC / 1000 as counter_HCHC FROM linky_history\r\n\t WHERE DAY(time) = $jour_releve_compteur AND HOUR(time) = 0 AND MINUTE(time) = 0) as A\r\n)\r\nORDER BY timestamp\r\n",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          },
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "hide": false,
            "rawQuery": true,
            "rawSql": "(SELECT\r\n    TIMESTAMP(DATE_FORMAT(MAX(time) - INTERVAL $jour_releve_compteur DAY + INTERVAL IF($jour_releve_compteur<15, 0, 1) MONTH + INTERVAL IF($jour_releve_compteur<15, 0, 1) DAY, '%Y-%m-24 00:00:00')) as \"timestamp\",\r\n      ROUND(AVG(temperature), 1) as \"Temperature\"\r\n    FROM\r\n      linky.linky_history\r\nWHERE time >= NOW() - INTERVAL $jour_releve_compteur DAY - INTERVAL 1 HOUR\r\n\t)\r\nUNION\r\n(SELECT\r\n      TIMESTAMP(DATE_FORMAT(MAX(time), '%Y-%m-$jour_releve_compteur 00:00:00')) as \"timestamp\",\r\n      ROUND(AVG(temperature), 1) as \"Temperature\"\r\n    FROM\r\n      linky.linky_history\r\n\tGROUP BY MONTH(time), YEAR(time))",
            "refId": "B",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "calculateField",
            "options": {
              "alias": "total_kwh",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHP"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHC"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              },
              "replaceFields": false
            }
          },
          {
            "id": "filterByValue",
            "options": {
              "filters": [
                {
                  "config": {
                    "id": "equal",
                    "options": {
                      "value": "0"
                    }
                  },
                  "fieldName": "total_kwh"
                }
              ],
              "match": "any",
              "type": "exclude"
            }
          },
          {
            "id": "formatTime",
            "options": {
              "outputFormat": "MM/YYYY",
              "timeField": "timestamp",
              "timezone": "browser",
              "useTimezone": true
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {
                "Temperature": true,
                "total_kwh_HCHC": true,
                "total_kwh_HCHP": true
              },
              "includeByName": {},
              "indexByName": {},
              "renameByName": {
                "timestamp": "Date",
                "total_kwh": "Consommation"
              }
            }
          }
        ],
        "transparent": true,
        "type": "barchart"
      },
      {
        "datasource": {
          "type": "datasource",
          "uid": "-- Dashboard --"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "continuous-GrYlRd"
            },
            "custom": {
              "align": "center",
              "cellOptions": {
                "type": "color-text",
                "wrapText": false
              },
              "filterable": false,
              "inspect": false,
              "minWidth": 100
            },
            "fieldMinMax": true,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "kWh"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Coût"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "€"
                },
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "text",
                    "mode": "continuous-GrYlRd"
                  }
                },
                {
                  "id": "decimals",
                  "value": 0
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Temperature"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "celsius"
                },
                {
                  "id": "decimals",
                  "value": 1
                },
                {
                  "id": "color",
                  "value": {
                    "mode": "continuous-BlYlRd"
                  }
                },
                {
                  "id": "noValue",
                  "value": "N/A"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Date"
              },
              "properties": [
                {
                  "id": "custom.cellOptions",
                  "value": {
                    "type": "auto",
                    "wrapText": false
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 21
        },
        "id": 8,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "enablePagination": false,
            "fields": [],
            "reducer": [
              "mean"
            ],
            "show": false
          },
          "showHeader": false,
          "sortBy": []
        },
        "pluginVersion": "11.4.0",
        "targets": [
          {
            "datasource": {
              "type": "datasource",
              "uid": "-- Dashboard --"
            },
            "panelId": 58,
            "refId": "A",
            "withTransforms": false
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "calculateField",
            "options": {
              "alias": "total_kwh",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHP"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHC"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hp",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHP"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$prix_hp"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              },
              "replaceFields": false
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hc",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHC"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$prix_hc"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hp_hc",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hp"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hc"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hp_hc"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$abonnement"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "filterFieldsByName",
            "options": {
              "byVariable": false,
              "include": {
                "names": [
                  "timestamp",
                  "total_kwh",
                  "Temperature",
                  "cout_hp_hc + abonnement"
                ]
              }
            }
          },
          {
            "id": "sortBy",
            "options": {
              "fields": {},
              "sort": [
                {
                  "desc": true,
                  "field": "timestamp"
                }
              ]
            }
          },
          {
            "id": "formatTime",
            "options": {
              "outputFormat": "MM/YYYY",
              "timeField": "timestamp",
              "timezone": "browser",
              "useTimezone": true
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "includeByName": {},
              "indexByName": {
                "Temperature": 3,
                "cout_hp_hc + abonnement": 2,
                "timestamp": 0,
                "total_kwh": 1
              },
              "renameByName": {
                "Temperature": "",
                "cout_hp_hc + abonnement": "Coût",
                "timestamp": "Date",
                "total_kwh": "Consommation"
              }
            }
          },
          {
            "id": "filterByValue",
            "options": {
              "filters": [
                {
                  "config": {
                    "id": "equal",
                    "options": {
                      "value": "0"
                    }
                  },
                  "fieldName": "Consommation"
                }
              ],
              "match": "any",
              "type": "exclude"
            }
          }
        ],
        "transparent": true,
        "type": "table"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 30
        },
        "id": 47,
        "panels": [],
        "title": "Historique par an",
        "type": "row"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "continuous-GrYlRd"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisGridShow": false,
              "axisLabel": "",
              "axisPlacement": "auto",
              "axisSoftMin": 2000,
              "fillOpacity": 100,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "lineWidth": 0,
              "scaleDistribution": {
                "type": "linear"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 0,
            "displayName": "Consommation",
            "fieldMinMax": false,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "kWh"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Date"
              },
              "properties": [
                {
                  "id": "unit"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 31
        },
        "id": 59,
        "options": {
          "barRadius": 0.3,
          "barWidth": 0.95,
          "colorByField": "Consommation",
          "fullHighlight": false,
          "groupWidth": 0.7,
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": false
          },
          "orientation": "vertical",
          "showValue": "never",
          "stacking": "none",
          "tooltip": {
            "hideZeros": false,
            "mode": "multi",
            "sort": "none"
          },
          "xField": "Date",
          "xTickLabelRotation": 0,
          "xTickLabelSpacing": -100
        },
        "pluginVersion": "11.4.0",
        "targets": [
          {
            "dataset": "linky",
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "(\r\nSELECT\r\n    TIMESTAMP(DATE_FORMAT(MAX(time), '%Y-%m-$jour_releve_compteur 00:00:00')) as \"timestamp\",\r\n\t(MAX(HCHP) - MIN(HCHP)) / 1000 AS \"total_kwh_HCHP\",\r\n    (MAX(HCHC) - MIN(HCHC)) / 1000 AS \"total_kwh_HCHC\"\r\nFROM linky_history\r\nWHERE time BETWEEN NOW() - INTERVAL 1 YEAR - INTERVAL 1 HOUR AND NOW()\r\n)\r\nUNION\r\n(SELECT\r\n      time as \"timestamp\", \r\n      IFNULL(counter_HCHP - LAG(counter_HCHP) OVER (ORDER BY time), 0) AS \"total_kwh_HCHP\",\r\n      IFNULL(counter_HCHC - LAG(counter_HCHC) OVER (ORDER BY time), 0) AS \"total_kwh_HCHC\"\r\nFROM\r\n    (SELECT time, HCHP / 1000 as counter_HCHP, HCHC / 1000 as counter_HCHC FROM linky_history\r\n\t WHERE DAY(time) = $jour_releve_compteur AND MONTH(time) = 12 AND HOUR(time) = 0 AND MINUTE(time) = 0) as A\r\n)\r\nORDER BY timestamp\r\n",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "calculateField",
            "options": {
              "alias": "total_kwh",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHP"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHC"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              },
              "replaceFields": false
            }
          },
          {
            "id": "filterByValue",
            "options": {
              "filters": [
                {
                  "config": {
                    "id": "equal",
                    "options": {
                      "value": "0"
                    }
                  },
                  "fieldName": "total_kwh"
                }
              ],
              "match": "any",
              "type": "exclude"
            }
          },
          {
            "id": "formatTime",
            "options": {
              "outputFormat": "YYYY",
              "timeField": "timestamp",
              "timezone": "browser",
              "useTimezone": true
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {
                "Temperature": true,
                "cout_hc": true,
                "cout_hp": true,
                "total_kwh_HCHC": true,
                "total_kwh_HCHP": true,
                "total_kwh_HCHP * prix_hp": true
              },
              "includeByName": {},
              "indexByName": {},
              "renameByName": {
                "timestamp": "Date",
                "total_kwh": "Consommation"
              }
            }
          }
        ],
        "transparent": true,
        "type": "barchart"
      },
      {
        "datasource": {
          "type": "datasource",
          "uid": "-- Dashboard --"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "continuous-GrYlRd"
            },
            "custom": {
              "align": "center",
              "cellOptions": {
                "type": "color-text"
              },
              "filterable": false,
              "inspect": false,
              "minWidth": 100
            },
            "fieldMinMax": true,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "kWh"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "timestamp"
              },
              "properties": [
                {
                  "id": "unit"
                },
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "text",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Prix"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "€"
                },
                {
                  "id": "decimals",
                  "value": 0
                },
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "text",
                    "mode": "continuous-GrYlRd"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 7,
          "w": 6,
          "x": 12,
          "y": 31
        },
        "id": 12,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "enablePagination": false,
            "fields": [],
            "reducer": [
              "mean"
            ],
            "show": false
          },
          "showHeader": false,
          "sortBy": []
        },
        "pluginVersion": "11.4.0",
        "targets": [
          {
            "datasource": {
              "type": "datasource",
              "uid": "-- Dashboard --"
            },
            "panelId": 59,
            "refId": "A",
            "withTransforms": false
          }
        ],
        "title": "",
        "transformations": [
          {
            "id": "formatTime",
            "options": {
              "outputFormat": "YYYY",
              "timeField": "timestamp",
              "timezone": "browser",
              "useTimezone": true
            }
          },
          {
            "id": "filterByValue",
            "options": {
              "filters": [
                {
                  "config": {
                    "id": "equal",
                    "options": {
                      "value": "0"
                    }
                  },
                  "fieldName": "total_kwh_HCHP"
                },
                {
                  "config": {
                    "id": "equal",
                    "options": {
                      "value": "0"
                    }
                  },
                  "fieldName": "total_kwh_HCHC"
                }
              ],
              "match": "any",
              "type": "exclude"
            }
          },
          {
            "id": "sortBy",
            "options": {
              "fields": {},
              "sort": [
                {
                  "desc": true,
                  "field": "timestamp"
                }
              ]
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hp",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHP"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$prix_hp"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hc",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHC"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$prix_hc"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hors_abo",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hp"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hc"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "abo_year",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "$abonnement"
                  }
                },
                "operator": "*",
                "right": {
                  "fixed": "12"
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "Prix",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hors_abo"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "abo_year"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHP"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHC"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {
                "abo_year": true,
                "cout_hc": true,
                "cout_hors_abo": true,
                "cout_hp": true,
                "total_kwh_HCHC": true,
                "total_kwh_HCHP": true,
                "total_kwh_HCHP + total_kwh_HCHC": false
              },
              "includeByName": {},
              "indexByName": {
                "Prix": 8,
                "abo_year": 6,
                "cout_hc": 4,
                "cout_hors_abo": 5,
                "cout_hp": 3,
                "timestamp": 0,
                "total_kwh_HCHC": 2,
                "total_kwh_HCHP": 1,
                "total_kwh_HCHP + total_kwh_HCHC": 7
              },
              "renameByName": {
                "Prix": "Prix",
                "total_kwh_HCHP + total_kwh_HCHC": "Consommation"
              }
            }
          }
        ],
        "transparent": true,
        "type": "table"
      },
      {
        "datasource": {
          "type": "mysql",
          "uid": "P211906C1C32DB77E"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 18,
          "y": 31
        },
        "id": 60,
        "options": {
          "baseValueField": "base",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 2,
          "percentageValueField": "current",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé à hier",
          "referenceTextFontSize": "10px",
          "unit": "kWh"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "dataset": "linky",
            "datasource": {
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "editorMode": "code",
            "format": "table",
            "hide": false,
            "rawQuery": true,
            "rawSql": "(\r\nSELECT \r\n  \"current\",\r\n  (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / 1000 as t\r\nFROM linky_history\r\nWHERE time BETWEEN NOW() - INTERVAL 1 YEAR - INTERVAL 1 HOUR AND NOW())\r\nUNION\r\n(SELECT \r\n  \"base\",\r\n  (MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / 1000 as t\r\nFROM linky_history\r\nWHERE time BETWEEN NOW() - INTERVAL 1 YEAR - INTERVAL 1 DAY - INTERVAL 1 HOUR AND NOW() - INTERVAL 1 DAY)",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Consommation de l'année",
        "transformations": [
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "current",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "t",
                  "handlerKey": "field.value"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "datasource": {
          "type": "datasource",
          "uid": "-- Dashboard --"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 18,
          "y": 34
        },
        "id": 61,
        "options": {
          "baseValueField": "1",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 0,
          "percentageValueField": "0",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé à l'année dernière",
          "referenceTextFontSize": "10px",
          "unit": "€"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "datasource": {
              "type": "datasource",
              "uid": "-- Dashboard --"
            },
            "panelId": 59,
            "refId": "A",
            "withTransforms": false
          }
        ],
        "title": "Facture moyenne année",
        "transformations": [
          {
            "id": "sortBy",
            "options": {
              "fields": {},
              "sort": [
                {
                  "desc": true,
                  "field": "timestamp"
                }
              ]
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hp",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHP"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$prix_hp"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_hc",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "total_kwh_HCHC"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$prix_hc"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_annee_hors_abo",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hp"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_hc"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "cout_mois_hors_abo",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_annee_hors_abo"
                  }
                },
                "operator": "/",
                "right": {
                  "fixed": "12"
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "alias": "prix_mensuel",
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "cout_mois_hors_abo"
                  }
                },
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "$abonnement"
                  }
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {
                "cout_annee_hors_abo": true,
                "cout_hc": true,
                "cout_hp": true,
                "cout_mois_hors_abo": true,
                "timestamp": false,
                "total_kwh_HCHC": true,
                "total_kwh_HCHP": true
              },
              "includeByName": {},
              "indexByName": {},
              "renameByName": {}
            }
          },
          {
            "id": "limit",
            "options": {
              "limitField": "2"
            }
          },
          {
            "id": "calculateField",
            "options": {
              "mode": "index",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "Row",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "prix_mensuel",
                  "handlerKey": "field.value"
                },
                {
                  "fieldName": "timestamp",
                  "handlerKey": "__ignore"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "datasource": {
          "type": "datasource",
          "uid": "-- Dashboard --"
        },
        "fieldConfig": {
          "defaults": {},
          "overrides": []
        },
        "gridPos": {
          "h": 3,
          "w": 6,
          "x": 18,
          "y": 37
        },
        "id": 37,
        "options": {
          "baseValueField": "1",
          "baseValueFontSize": "14px",
          "interpretAsTrend": true,
          "percentageNrDecimals": 0,
          "percentageValueField": "0",
          "percentageValueFontSize": "80%",
          "positiveIsGood": false,
          "referenceText": "comparé à l'année dernière",
          "referenceTextFontSize": "10px",
          "unit": "W"
        },
        "pluginVersion": "1.0.8",
        "targets": [
          {
            "datasource": {
              "type": "datasource",
              "uid": "-- Dashboard --"
            },
            "panelId": 59,
            "refId": "A",
            "withTransforms": true
          }
        ],
        "title": "Puissance moyenne année",
        "transformations": [
          {
            "id": "sortBy",
            "options": {
              "fields": {},
              "sort": [
                {
                  "desc": true,
                  "field": "Date"
                }
              ]
            }
          },
          {
            "id": "limit",
            "options": {
              "limitField": "2"
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "Date"
                  }
                },
                "operator": "*",
                "right": {
                  "matcher": {
                    "id": "byName",
                    "options": "Date"
                  }
                }
              },
              "index": {
                "asPercentile": false
              },
              "mode": "index",
              "reduce": {
                "include": [],
                "reducer": "lastNotNull"
              },
              "replaceFields": false
            }
          },
          {
            "id": "calculateField",
            "options": {
              "binary": {
                "left": {
                  "matcher": {
                    "id": "byName",
                    "options": "Consommation"
                  }
                },
                "operator": "/",
                "right": {
                  "fixed": "8.760"
                }
              },
              "mode": "binary",
              "reduce": {
                "reducer": "sum"
              }
            }
          },
          {
            "id": "rowsToFields",
            "options": {
              "mappings": [
                {
                  "fieldName": "Row",
                  "handlerKey": "field.name"
                },
                {
                  "fieldName": "Consommation / 8.760",
                  "handlerKey": "field.value"
                },
                {
                  "fieldName": "Date",
                  "handlerKey": "__ignore"
                },
                {
                  "fieldName": "Consommation",
                  "handlerKey": "__ignore"
                }
              ]
            }
          }
        ],
        "transparent": true,
        "type": "nikosc-percenttrend-panel"
      },
      {
        "collapsed": true,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 40
        },
        "id": 24,
        "panels": [
          {
            "datasource": {
              "default": true,
              "type": "mysql",
              "uid": "P211906C1C32DB77E"
            },
            "description": "",
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "decimals": 3,
                "mappings": [],
                "thresholds": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green"
                    },
                    {
                      "color": "red",
                      "value": 80
                    }
                  ]
                },
                "unit": "kWh"
              },
              "overrides": [
                {
                  "matcher": {
                    "id": "byName",
                    "options": "Cos φ"
                  },
                  "properties": [
                    {
                      "id": "unit"
                    },
                    {
                      "id": "decimals"
                    }
                  ]
                },
                {
                  "matcher": {
                    "id": "byName",
                    "options": "PAPP"
                  },
                  "properties": [
                    {
                      "id": "unit",
                      "value": "VA"
                    },
                    {
                      "id": "decimals",
                      "value": 0
                    }
                  ]
                },
                {
                  "matcher": {
                    "id": "byName",
                    "options": "Cos φ"
                  },
                  "properties": [
                    {
                      "id": "decimals",
                      "value": 2
                    }
                  ]
                },
                {
                  "matcher": {
                    "id": "byName",
                    "options": "Consommation veille"
                  },
                  "properties": [
                    {
                      "id": "unit",
                      "value": "W"
                    },
                    {
                      "id": "decimals",
                      "value": 0
                    }
                  ]
                }
              ]
            },
            "gridPos": {
              "h": 6,
              "w": 12,
              "x": 0,
              "y": 41
            },
            "id": 25,
            "options": {
              "colorMode": "none",
              "graphMode": "area",
              "justifyMode": "auto",
              "orientation": "horizontal",
              "percentChangeColorMode": "standard",
              "reduceOptions": {
                "calcs": [
                  "lastNotNull"
                ],
                "fields": "/.*/",
                "values": false
              },
              "showPercentChange": false,
              "text": {
                "valueSize": 22
              },
              "textMode": "value_and_name",
              "wideLayout": true
            },
            "pluginVersion": "11.4.0",
            "targets": [
              {
                "dataset": "linky",
                "datasource": {
                  "type": "mysql",
                  "uid": "P211906C1C32DB77E"
                },
                "editorMode": "code",
                "format": "table",
                "rawQuery": true,
                "rawSql": "SELECT $cosphi as \"Cos φ\", \r\n       PAPP,\r\n       HCHP/1000 AS \"Heures Pleines\", \r\n       HCHC/1000 AS \"Heures Creuses\"\r\nFROM linky.linky_realtime\r\nORDER BY time DESC LIMIT 1\r\n",
                "refId": "A",
                "sql": {
                  "columns": [
                    {
                      "parameters": [
                        {
                          "name": "PAPP",
                          "type": "functionParameter"
                        }
                      ],
                      "type": "function"
                    }
                  ],
                  "groupBy": [
                    {
                      "property": {
                        "type": "string"
                      },
                      "type": "groupBy"
                    }
                  ],
                  "limit": 50
                },
                "table": "linky_realtime"
              }
            ],
            "title": "",
            "transparent": true,
            "type": "stat"
          }
        ],
        "title": "Informations",
        "type": "row"
      }
    ],
    "preload": false,
    "refresh": "2s",
    "schemaVersion": 40,
    "tags": [],
    "templating": {
      "list": [
        {
          "current": {
            "text": "24",
            "value": "24"
          },
          "description": "Jour de relevé du compteur électrique par votre fournisseur",
          "hide": 2,
          "name": "jour_releve_compteur",
          "options": [
            {
              "selected": true,
              "text": "24",
              "value": "24"
            }
          ],
          "query": "24",
          "type": "textbox"
        },
        {
          "current": {
            "text": "18.01",
            "value": "18.01"
          },
          "description": "Abonnement mensuel TTC (en €)",
          "hide": 2,
          "label": "Abonnement mensuel",
          "name": "abonnement",
          "query": "18.01",
          "skipUrlSync": true,
          "type": "constant"
        },
        {
          "current": {
            "text": "0.224",
            "value": "0.224"
          },
          "description": "Prix Heures Pleines (en €/kWh)",
          "hide": 2,
          "label": "Prix Heures Pleines",
          "name": "prix_hp",
          "query": "0.224",
          "skipUrlSync": true,
          "type": "constant"
        },
        {
          "current": {
            "text": "0.1555",
            "value": "0.1555"
          },
          "description": "Prix Heures Creuses (en €/kWh)",
          "hide": 2,
          "label": "Prix Heures Creuses",
          "name": "prix_hc",
          "query": "0.1555",
          "skipUrlSync": true,
          "type": "constant"
        },
        {
          "current": {
            "text": "01/02/2025 10:21:29",
            "value": "01/02/2025 10:21:29"
          },
          "definition": "SELECT DATE_FORMAT(time, '%d/%m/%Y %H:%i:%s') FROM linky_realtime ORDER BY time DESC LIMIT 1",
          "description": "",
          "hide": 2,
          "name": "last_update",
          "options": [],
          "query": "SELECT DATE_FORMAT(time, '%d/%m/%Y %H:%i:%s') FROM linky_realtime ORDER BY time DESC LIMIT 1",
          "refresh": 2,
          "regex": "",
          "type": "query"
        },
        {
          "current": {
            "text": "2.7",
            "value": "2.7"
          },
          "definition": "SELECT round(temperature, 1) FROM linky_realtime ORDER BY time DESC LIMIT 1",
          "description": "",
          "hide": 2,
          "name": "last_temperature",
          "options": [],
          "query": "SELECT round(temperature, 1) FROM linky_realtime ORDER BY time DESC LIMIT 1",
          "refresh": 2,
          "regex": "",
          "sort": 1,
          "type": "query"
        },
        {
          "current": {
            "text": "0.97470388",
            "value": "0.97470388"
          },
          "definition": "SELECT(MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / (TIMESTAMPDIFF(SECOND, min(time), max(time)) / 3600) / AVG(PAPP) FROM linky_realtime",
          "hide": 2,
          "name": "cosphi",
          "options": [],
          "query": "SELECT(MAX(HCHP) - MIN(HCHP) + MAX(HCHC) - MIN(HCHC)) / (TIMESTAMPDIFF(SECOND, min(time), max(time)) / 3600) / AVG(PAPP) FROM linky_realtime",
          "refresh": 2,
          "regex": "",
          "type": "query"
        },
        {
          "current": {
            "text": "31",
            "value": "31"
          },
          "definition": "SELECT\n    CASE WHEN DAYOFMONTH(current_date) <= $jour_releve_compteur\n\tTHEN \n        DAYOFMONTH(LAST_DAY(DATE_ADD(DATE_SUB(current_date, interval 1 month), interval $jour_releve_compteur - DAYOFMONTH(current_date) day)))                     \n    ELSE\n        DAYOFMONTH(LAST_DAY(date_add(current_date, interval $jour_releve_compteur - DAYOFMONTH(current_date) day)))\n    END",
          "hide": 2,
          "name": "nb_days_period",
          "options": [],
          "query": "SELECT\n    CASE WHEN DAYOFMONTH(current_date) <= $jour_releve_compteur\n\tTHEN \n        DAYOFMONTH(LAST_DAY(DATE_ADD(DATE_SUB(current_date, interval 1 month), interval $jour_releve_compteur - DAYOFMONTH(current_date) day)))                     \n    ELSE\n        DAYOFMONTH(LAST_DAY(date_add(current_date, interval $jour_releve_compteur - DAYOFMONTH(current_date) day)))\n    END",
          "refresh": 2,
          "regex": "",
          "type": "query"
        },
        {
          "current": {
            "text": "115",
            "value": "115"
          },
          "definition": "SELECT ROUND(MIN(PAPP) * $cosphi / 5) * 5 FROM linky.linky_realtime;",
          "hide": 2,
          "name": "consommation_veille",
          "options": [],
          "query": "SELECT ROUND(MIN(PAPP) * $cosphi / 5) * 5 FROM linky.linky_realtime;",
          "refresh": 2,
          "regex": "",
          "type": "query"
        }
      ]
    },
    "time": {
      "from": "now-10m",
      "to": "now"
    },
    "timepicker": {
      "hidden": true,
      "nowDelay": "",
      "refresh_intervals": [
        "2s",
        "10s",
        "30s",
        "1m"
      ]
    },
    "timezone": "browser",
    "title": "Linky",
    "uid": "ce2bc2ee-bb6d-485a-863e-4bfa308445a8",
    "version": 3,
    "weekStart": "monday"
  }